<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for lib/command.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">lib/</a> command.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">12.09% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>11/91</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">4% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>2/50</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">11.11% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">13.1% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>11/84</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">"use strict";
// call preload hooks at the very beginning as they may help require other modules (including commander!)
// register will call them again but it shouldn't hurt because require caches.
(function() {
	var i = process.argv.indexOf('--preload') + 1;
	<span class="missing-if-branch" title="if path not taken" >I</span>if (i &gt; 0 &amp;&amp; <span class="branch-1 cbranch-no" title="branch not covered" >process.argv[i])</span> <span class="cstat-no" title="statement not covered" >process.argv[i].split(',').forEach(<span class="fstat-no" title="function not covered" >function(m) {</span></span>
<span class="cstat-no" title="statement not covered" >		require(m);</span>
	});
})();
&nbsp;
// handles _node and _coffee command line options
var fs = require('fs');
var fsp = require('path');
var util = require('./util');
var register = require('./register');
var Module = require('module');
&nbsp;
<span class="fstat-no" title="function not covered" >function parseOptions(argv) {</span>
<span class="cstat-no" title="statement not covered" >	var program = require('commander');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	var prog = program.version(require('../package').version, '-v, --version')</span>
		.usage('[options] [script] [arguments]')
		.option('-c, --compile', "compile [script] files and save as *.js files")
		.option('-d, --out-dir &lt;dir&gt;', "save compiled .js files in the given directory")
		.option('--no-cache', "turns caching off", true)
		.option('--cache-dir &lt;dir&gt;', "sets the cache directory")
		.option('-f, --force', "force transformation (even if found in cache)")
		.option('--runtime &lt;name&gt;', "target runtime")
		.option('-s, --source-maps &lt;true|false|inline|both&gt;', "(see babel)", /^(true|false|inline|both)$/)
		.option('--source-map-target &lt;file&gt;', "output file for source map")
		.option('--only-extensions &lt;exts&gt;', "list of extensions to process (comma-separated)")
		.option('-q, --quiet', "don't log")
		.option('--preload &lt;modules&gt;', "hook to preload a specified list of modules (comma-separated)");
&nbsp;
	// Arguments that follow the script or filename should not be intercepted by commander but passed
	// verbatim to the script (https://github.com/Sage/streamlinejs/issues/297)
	// There may be a clever way to do this with commander but the following hack should do for now
	// I'm handling compat in the same loop to cut correctly if script accepts obsolete streamline options (-o for ex).
	// commander skips 2 first args, not just first one.
<span class="cstat-no" title="statement not covered" >	var args = argv.slice(0, 2);</span>
<span class="cstat-no" title="statement not covered" >	var cut = 2;</span>
<span class="cstat-no" title="statement not covered" >	while (cut &lt; argv.length) {</span>
<span class="cstat-no" title="statement not covered" >		var arg = argv[cut];</span>
<span class="cstat-no" title="statement not covered" >		if (arg[0] !== '-') <span class="cstat-no" title="statement not covered" >break;</span></span>
<span class="cstat-no" title="statement not covered" >		cut++;</span>
<span class="cstat-no" title="statement not covered" >		var opt = prog.options.filter(<span class="fstat-no" title="function not covered" >function(o) {</span></span>
<span class="cstat-no" title="statement not covered" >			return o.short === arg || o.long === arg;</span>
		})[0];
<span class="cstat-no" title="statement not covered" >		if (opt) {</span>
<span class="cstat-no" title="statement not covered" >			args.push(arg);</span>
<span class="cstat-no" title="statement not covered" >			if (opt.flags.indexOf('&lt;') &gt;= 0 &amp;&amp; cut &lt; argv.length) {</span>
<span class="cstat-no" title="statement not covered" >				args.push(argv[cut++]);</span>
			}
		} else {
			// handle compat options
<span class="cstat-no" title="statement not covered" >			if (arg === '--cache') {</span>
				// ignore silently - cache is now on by default.
			} else <span class="cstat-no" title="statement not covered" >if (/^(-l(m|i|p)|--(lines-(mark|ignore|preserve)|standalone|fast|old-style-future|promise|cb|aggressive))$/.test(arg)) {</span>
<span class="cstat-no" title="statement not covered" >				util.warn('obsolete option ignored: ' + arg);</span>
<span class="cstat-no" title="statement not covered" >				return;</span>
			} else <span class="cstat-no" title="statement not covered" >if (arg === '--map') {</span>
<span class="cstat-no" title="statement not covered" >				util.warn('obsolete option: --map, use -s or --source-maps instead');</span>
<span class="cstat-no" title="statement not covered" >				args.push('--source-maps');</span>
<span class="cstat-no" title="statement not covered" >				args.push('true');</span>
<span class="cstat-no" title="statement not covered" >				return;</span>
			} else <span class="cstat-no" title="statement not covered" >if (arg === '--source-map') {</span>
<span class="cstat-no" title="statement not covered" >				util.warn('obsolete option: --source-map, use --source-map-target instead');</span>
<span class="cstat-no" title="statement not covered" >				args.push('--source-map-target');</span>
			} else <span class="cstat-no" title="statement not covered" >if (/^--(fibers|generators)$/.test(arg)) {</span>
<span class="cstat-no" title="statement not covered" >				util.warn('obsolete option: ' + arg + ', use --runtime ' + arg.substring(2) + ' instead');</span>
<span class="cstat-no" title="statement not covered" >				args.push('--runtime');</span>
<span class="cstat-no" title="statement not covered" >				args.push(arg.substring(2));</span>
			} else <span class="cstat-no" title="statement not covered" >if (/^(-o|--output-dir)$/.test(arg)) {</span>
<span class="cstat-no" title="statement not covered" >				util.warn('obsolete option: ' + arg + ', use -d or --out-dir instead');</span>
<span class="cstat-no" title="statement not covered" >				args.push('-d');</span>
<span class="cstat-no" title="statement not covered" >				if (cut &lt; argv.length) <span class="cstat-no" title="statement not covered" >args.push(argv[cut++]);</span></span>
			} else <span class="cstat-no" title="statement not covered" >if (arg === '-v') {</span>
<span class="cstat-no" title="statement not covered" >				util.warn('obsolete option: -v, verbose is on by default, use -q to turn it off');</span>
			} else {
				// push invalid option - commander will deal with it
<span class="cstat-no" title="statement not covered" >				args.push(arg);</span>
			}
		}
	}
		
<span class="cstat-no" title="statement not covered" >	var options = prog.parse(args);</span>
<span class="cstat-no" title="statement not covered" >	options.args = options.args.concat(argv.slice(cut));</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	options = Object.keys(options).filter(<span class="fstat-no" title="function not covered" >function(opt) {</span></span>
<span class="cstat-no" title="statement not covered" >		return !/^([A-Z]|_)/.test(opt);</span>
	}).reduce(<span class="fstat-no" title="function not covered" >function(opts, key) {</span>
<span class="cstat-no" title="statement not covered" >		opts[key] = options[key];</span>
<span class="cstat-no" title="statement not covered" >		return opts;</span>
	}, {});
<span class="cstat-no" title="statement not covered" >	if (options.onlyExtensions) <span class="cstat-no" title="statement not covered" >options.onlyExtensions = options.onlyExtensions.split(',');</span></span>
<span class="cstat-no" title="statement not covered" >	return util.getOptions(util.extend(util.envOptions(), options));</span>
};
&nbsp;
<span class="fstat-no" title="function not covered" >function runScript(options) {</span>
<span class="cstat-no" title="statement not covered" >	var filename = options.args[0];</span>
&nbsp;
	// We'll make that file the "main" module by reusing the current one.
<span class="cstat-no" title="statement not covered" >	var mainModule = require.main;</span>
&nbsp;
	// Clear the main module's require cache.
<span class="cstat-no" title="statement not covered" >	if (mainModule.moduleCache) {</span>
<span class="cstat-no" title="statement not covered" >		mainModule.moduleCache = {};</span>
	}
&nbsp;
	// Set the module's paths and filename. Luckily, Node exposes its native
	// helper functions to resolve these guys!
	// https://github.com/joyent/node/blob/master/lib/module.js
	// Except we need to tell Node that these are paths, not native modules.
<span class="cstat-no" title="statement not covered" >	filename = fsp.resolve(filename || '.');</span>
<span class="cstat-no" title="statement not covered" >	mainModule.filename = filename = Module._resolveFilename(filename);</span>
<span class="cstat-no" title="statement not covered" >	var localPaths = Module._nodeModulePaths(fsp.join(process.cwd(), 'node_modules'));</span>
<span class="cstat-no" title="statement not covered" >	var globalPaths = Module._nodeModulePaths(fsp.join(__dirname, '../node_modules'));</span>
<span class="cstat-no" title="statement not covered" >	mainModule.paths = localPaths.slice(0, localPaths.length - 1).concat(globalPaths);</span>
&nbsp;
	//process.execPath = filename;
	// Load the target file and evaluate it as the main module.
	// The input path should have been resolved to a file, so use its extension.
	// If the file doesn't have an extension (e.g. scripts with a shebang),
	// go by what executable this was called as.
<span class="cstat-no" title="statement not covered" >	var ext = fsp.extname(filename);</span>
<span class="cstat-no" title="statement not covered" >	if (!/(\._?(js|coffee)|ts)$/.test(ext)) <span class="cstat-no" title="statement not covered" >ext = /^_coffee/.test(fsp.basename(process.argv[1])) ? '._coffee' : '._js';</span></span>
	// Update the process argv and execPath too.
<span class="cstat-no" title="statement not covered" >	process.argv = [process.argv[1], filename].concat(options.args.slice(1));</span>
<span class="cstat-no" title="statement not covered" >	if (!require.extensions[ext]) <span class="cstat-no" title="statement not covered" >throw new Error("unsupported extension: " + ext);</span></span>
<span class="cstat-no" title="statement not covered" >	require.extensions[ext](mainModule, filename);</span>
}
&nbsp;
exports.run = <span class="fstat-no" title="function not covered" >function() {</span>
	// require cluster here so that it gets process.argv before we shift it.
<span class="cstat-no" title="statement not covered" >	if (require('cluster').setupMaster) <span class="cstat-no" title="statement not covered" >require('cluster').setupMaster();</span></span>
<span class="cstat-no" title="statement not covered" >	var argv = process.argv;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	var prog = /\w*$/.exec(argv[1])[0];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	var options = parseOptions(argv);</span>
<span class="cstat-no" title="statement not covered" >	register.register(options);</span>
<span class="cstat-no" title="statement not covered" >	if (options.compile) {</span>
<span class="cstat-no" title="statement not covered" >		require('./compile').compile(<span class="fstat-no" title="function not covered" >function(err) {</span></span>
<span class="cstat-no" title="statement not covered" >			if (err) {</span>
<span class="cstat-no" title="statement not covered" >				console.error(err.message + "\n" + err.stack); </span>/* eslint-disable no-process-exit */
<span class="cstat-no" title="statement not covered" >				process.exit(1);</span>
			}
		}, options.args, options);		
	} else <span class="cstat-no" title="statement not covered" >if (options.args.length === 0) {</span>
<span class="cstat-no" title="statement not covered" >		require("./repl").run(prog, options);</span>
	} else {
<span class="cstat-no" title="statement not covered" >		runScript(options);		</span>
	}
};</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Jul 30 2020 18:59:47 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
